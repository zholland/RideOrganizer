<%= render 'shared/header' %>
<%= render 'shared/nav' %>


<div class="content-pages" id="edit-trip-page">
  <div class="container">
    <h2>New Trip</h2>

    <div class="row">
      <div class="col-lg-12">
        <%= form_for :trip, url: trip_plans_path, html: {id: 'new-trip-form'} do |f| %>
            <p>
              <%= f.submit 'Create Trip', :class => 'btn btn-default submit-button' %>
            </p>
            <p class="trip-form">
              <%= f.label :destination_address %><br>
              <%= f.text_field :destination_address %>
            </p>

            <p class="trip-form">
              <%= f.label 'Arrival Time' %><br>
              <%= f.datetime_select :arrival_time %>
            </p>
        <% end %>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <%= form_for :trip, :html => {:class => 'trip-form', :multipart => true}, :remote => true do |f| %>
            <%= f.label 'Upload list of travellers' %>
            <%= f.file_field :traveller_csv, id: 'csv-field' %>
            <%= f.submit 'Upload', class: 'btn btn-default submit-button' %>
        <% end %>

        <h3>Drivers</h3>
        <table id="drivers-table" class="table">
          <thead>
          <th>Name</th>
          <th>Email</th>
          <th>Address</th>
          <th>Vehicle Capacity</th>
          </thead>
          <tbody>

          </tbody>
        </table>
        <h3>Passengers</h3>
        <table id="passengers-table" class="table">
          <thead>
          <th>Name</th>
          <th>Email</th>
          <th>Address</th>
          </thead>
          <tbody>

          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<%= javascript_tag do %>
    $(function(){
        $("#new-trip-form").submit(function(e){

            if (!$("#trip_destination_address").val()) {
                e.preventDefault();
                alert('Destination address cannot be empty!');
            }
            else {
                var pattern = /[a-zA-Z 0-9 -]/;

                if (pattern.test($("#trip_destination_address").val())) {
                    <%  #coordinate_array = Geocoder.do_geocode(trip_address)
                        coordinate_array = nil
                        if coordinate_array == nil %>
                        e.preventDefault();
                        alert('You have entered an invalid destination address, please enter a different address.');
                    <% else %>
                        $("#new-trip-form").submit();
                    <% end %>
                }
                else {
                    alert('You have entered an invalid destination address, please enter a different address.');
                }

            }
        });
    });

<% end %>